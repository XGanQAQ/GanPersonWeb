计划
前一天没完成会继承到下一天

执行
具体执行过程
## 2025/5/9 初期准备
技术选型，架构设计，功能设计
写了一些文档

接下来就是创建一些项目文件了

## 2025/5/10 创建项目文件
使用MudBlazor的模板创建了项目文件

GanPersonWeb.Client 是前端 UI；
GanPersonWeb 同时作为：
静态资源托管服务（为前端提供 Blazor 文件）；
Web API 服务（通过 REST 提供数据）。

## 2025/5/11 前端初步完成
前端初步完成
构建shard项目

## 2025/5/12 完成后端api的基本框架
完成后端api的基本框架，用户、个人信息、项目、博客api接口
在前端blazor调用服务的时候，出现了异常，没办法注册上服务。
解决了，需要在后端中注册上blazor需要的服务，前端变得依赖于后端了。

我觉得把之前那个ai生成的界面用静态界面就好了，那个风格太注重游戏开发，反而不适合我这个个人网站了。
个人网站还是要简洁一些，突出个人信息和项目展示。
那个作为一个静态网站就好了，特殊需要的时候再作展示。
所以我需要重新设计一下home界面。

## 2025/5/13 前端界面
初步完成了前端的设计，使用了MudBlazor的组件库，整体风格简洁明了。

## 2025/5/14 优化前端界面+控制台界面
优化了前端界面，实现控制台界面。
后端补全了一些需要的接口

## 2025/5/15
- [x] 补全后端接口
- [x] 前端调用接口
- [x] 优化前端界面

## 2025/5/16
计划
- [x] 优化博客接口传递信息的逻辑，非指定获得博客，无需传递博客具体内如
- [ ] 排序组件
- [ ] Tag分类组件
- [x] 卡牌信息添加显示发布日期、浏览量
- [x] 博客详细界面 
- [x] 后端Markdown转换html服务逻辑
- [x] 数据面板
    - [x] 站点统计
    - [x] 项目统计
    - [x] 博客统计
- [x] Home界面的个人信息面板

不知道为什么，blazor的css隔离没能正常工作，导致作用于博客文章美化的样式不起作用

## 2025/5/17 个人网站开发反思
差不多开发了一个周，博客基本功能都行了，但是作为一个我希望的强大的个人网站，还是有很多不足的地方。
缺少一些我所期望的功能，主要是管理方面。
首先我需要理清一个清晰的发展思路，简洁、强大、可拓展性强

我该如何实现高可拓展性呢？
我觉得可以从以下几个方面入手：
1. 可拓展前端界面主题
    1. 主题色 利用Mudblazor的主题调色盘可以快速实现
    2. 主题风格 

2. 可拓展模板界面（视图） 
很多时候一个界面并不需要过多的复用，填写上一些信息就可以了。
我可以提前写好一些模板，用户可以选择使用，只需要在后台填写上一些信息就行了。
还可以利用开源社交网站模板，提供给用户更多选择。
想要实现这个功能，我需要在前端和后端都实现一个模板的概念。
首先我要搞明白blazor的组件化原理，能不能在运行时动态加载组件。
如果可以的话，我就可以在前后端实现一个组件加载器，可以在运行的时候，让玩家上传/从第三方网站下载组件。
然后在运行的时候加载组件。
我觉得最好是可以实现像winform那样的设计器，用户可以在设计器中拖拽组件，然后在运行的时候加载组件。
保存设计器的设计图，用户可以在运行的时候加载设计图。（有些复杂）
这样能极大的提高非专业用户创建自己独特界面的能力（感觉有点像Notion的概念），同时也可以利用开源社区的力量，提供更多的组件供用户使用。
这样就可以实现一个强大的组件化网站了，但是它有一些缺点，就是只能仅仅展示组件，不能实现复杂的逻辑，复杂的逻辑功能需要额外的设计。

3. 可拓展插件（控制器）
上述的模板界面，解决了展示的问题，但是它并不能实现复杂的逻辑功能。
我需要一个插件的概念，插件可以实现复杂的逻辑功能，数据交互。
插件的作用是向视图提供数据，视图可以通过插件提供的数据来实现复杂的逻辑功能。

4. 可拓展数据模型（模型）
可拓展数据模型，为用户提供更多可以存储在数据库中的数据。这样用户就可以通过给插件提供额外的数据来实现复杂的逻辑功能。

上述的高可拓展性设计，代价是比较大的，它会增加很多复杂的逻辑。
这需要大量的开发投入，我需要仔细思考一下是否值得。

1. 这样的高可拓展性设计，真的有必要吗？如果我真的想这样高度自定义，我为什么不直接在源码中修改呢？
    1. 可拓展各种组件的意义是调动开源社区的力量，提供更多的组件供用户使用。
    2. 可拓展插件的意义是提供更多的功能供用户使用。
    3. 视图组件可以充分利用Blazor的组件化特性，就无需在自己去编写代码了。我可以设想到的是，社区中有人会编写一套统一风格的组件，用户可以直接使用。既可以解决界面美化的问题，又可以解决复杂逻辑的问题。

2. 我为什么不直接用Notion?
    1. Notion闭源且运行在他人的服务器上，而且高级功能需要收费。
    2. Notion基于React，而我希望使用Blazor。
    3. 很显然Notion作为一个大公司的成熟产品，它对于普通人的简单展示网站来说，体验是非常好的。但是对于拥有一定技术能力的开发者来说，如果希望可以自部署Web应用，不想每个月付费，Notion就不适合了。

3. 为什么使用我的产品，而不是其他的产品？
    1. 用户可以自由使用。
    2. 用户可以自由部署在自己的服务器上。
    3. 用户可以自由使用Blazor的组件化特性。
    4. 用户可以自由使用Markdown的语法。
    5. 用户可以自由使用插件。

要实现这样的设计，需要我大改之前的方案，将所有功能都拆分成一个个的组件，插件，模型。
先设计好一个组件化的框架，然后再设计插件，模型。然后在通过组件来实现我的网站。

经过AI的分析之后，AI认为我这样的设计更像一个基于Blazor的低代码平台。
我觉得我先将这个博客的基本功能实现出来，以后再考虑从头构建基于Blazor的低代码平台问题，
目前这个项目先专注实现博客+个人网站功能。

## 2025/5/18 
- [ ] 热门博客推荐
- [ ] 博客展示排序/Tag分类
- [ ] 项目展示排序/Tag分类
- [x] 用户系统
- [ ] 评论功能

我从ai上了解到，评论系统建议使用第三方，而且有一个名为Waline的开源免费自部署的评论系统，可以尝试接入。
还是开发轻量的评论系统吧，只需要用户登陆，和文字评论就行了。

遇到了一个问题, JWT认证需要在每次请求的时候都要携带token, 但是我并不想在每次请求的时候都要携带token。
之前因为没有使用带JWT认证的接口，现在需要使用了，为了不在每次请求的时候都要携带token。
我需要修改一下httpclient的请求头，添加上token。（请参考AI解决方案）
AI提出的解决方案不正确，我的设想是给HttpClient再包装一层服务加上Token。
但是AI提供了一个修改添加HttpClient请求头的解决方案。（但是有一次尝试失败了）

- [x]修复携带jwttoken的问题
遇到很多问题
1. JWT令牌获取BUG，
因为开启了预渲染，
所以无法在AuthMessageHandler中配置localstorage获得存储在浏览器中的JWTToken，
HttpMessageHandler 的设计理念是和传输逻辑相关，不应依赖浏览器环境（比如 localStorage）。

2. 地址获取BUG
    1. BaseAddress不能为空

因为JWT令牌有可能在客户端运行期间发生变化，所以无法在服务阶段就提前配置好。
所以应该在具体调用之前，检查更新存入JWT配置。

## 2025/5/19
计划
- [ ] 热门博客推荐
- [ ] 博客展示排序/Tag分类
- [ ] 项目展示排序/Tag分类
- [x] 修复JWT令牌BUG
- [x] 修复BlogDetail的CSS隔离问题
- [ ] 测试上传功能
- [x] 实现调色盘控制，更多主题
- [ ] 评论功能
- [ ] 如何给MudCard添加动画效果？比如鼠标点击时，或者鼠标悬停时，添加动画效果。

### 执行
#### JWT
利用HttpClient的_httpClient.DefaultRequestHeaders.Authorization属性
有关JWT令牌的逻辑
- 在登陆成功之后，获取到JWT令牌，存储在localstorage中，并且在HttpClient的请求头中添加上JWT令牌。
- 检查登陆的时候，是否存在localstorage中的JWT令牌，如果存在，直接使用localstorage中的JWT令牌。
- 登出的时候，清除localstorage中的JWT令牌，并且在HttpClient的请求头中清除JWT令牌。

通过上述逻辑已经可以通过后端API的Authorize认证
现在是在具体解析的时候，出现了问题。UserId==null
通过完善在Program中的JWT配置，添加上JWT的解析逻辑
再使用User.FindFirst(ClaimTypes.NameIdentifier)?.Value获得UserId
成功解决了bug

#### BlogDetail
css隔离似乎存在问题
于是我把css隔离去掉了，直接使用全局的css样式

#### 调色盘
编写一个服务，进行调色盘的控制。主题先暂时在前端硬编码一些预设主题，后期在和后端做联动，实现自定义主题。
需要了解一下Mudblazor都准备了哪些预设Color, 设定好基本组件使用Color的规范

#### 动画效果
可以使用CSS来实现动画效果，CSS :hover 和 :active
于是我创建了一个CSS文件，专门用来实现动画效果。
MudCardAnimation.css 存放MudCard的动画效果

## 2025/5/21 day12
计划
- [ ] 热门博客推荐
- [ ] 博客展示排序/Tag分类
- [ ] 项目展示排序/Tag分类
- [ ] 完善上传功能
    - [x] 个人信息界面
    - [x] 博客界面
    - [x] 项目界面
- [ ] 评论功能
    - [x] 后端
- [x] 如何给MudCard添加动画效果？比如鼠标点击时，或者鼠标悬停时，添加动画效果。
- [ ] 修复关联表的查询bug
    - [x] 个人信息表和联系方式表的关联查询
    - [x] 博客表和评论表的关联查询

执行
因为修改了Shared项目的名称空间，导致大量更改，回滚了一次。
主要是为了解决Model作为DTO有一些问题，会出现循环引用的问题（如果想直接带有导航属性在）(在添加联系方式于个人信息的关系)。
所以我打算在Service层面查询打包有关联表的数据。而不是在Model中直接使用导航属性，这样就不会出现循环引用问题了吧。

完善了修改个人信息的界面，博客上传的界面，项目上传界面。

## 2025/5/22 day13
计划
- [ ] 热门博客推荐
- [ ] 博客展示排序/Tag分类
- [ ] 项目展示排序/Tag分类
- [ ] 完善上传功能
    - [ ] 上传图片
- [x] 评论功能
    - [x] 后端
    - [x] 前端
- [ ] 完善主题功能 
    - [x] 默认主题
    - [ ] 自定义主题功能
- [x] 优化博客具体展示界面
- [x] SQLite数据库
执行
完成博客界面评论的前端，并接入了后端的API接口。

### 如何配色
一深一浅，分别作为背景色和文字色
三个强调色
通过类名切换实现黑暗模式和亮色模式的切换

### 使用SQLite数据库
```csharp
if (builder.Environment.IsDevelopment())
{
    var connection = new SqliteConnection("DataSource=:memory:");
    connection.Open();
    builder.Services.AddDbContext<GanPersonDbContext>(options =>
        options.UseSqlite(connection));
}
else
{
    builder.Services.AddDbContext<GanPersonDbContext>(options =>
        options.UseSqlite(builder.Configuration.GetConnectionString("DefaultConnection")));
}
```
开发环境下为内存数据库，生产环境下为SQLite数据库。
可以通过修改launchSettings.json来改变是否为开发环境(ASPNETCORE_ENVIRONMENT)。

```json
{
  "profiles": {
    "GanPersonWeb": {
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  }
}
```

## 2025/5/23 day14
计划
- [ ] 热门博客推荐
- [ ] 博客展示排序/Tag分类
- [ ] 项目展示排序/Tag分类
    - [ ] DisplayProject的Tag过滤接口
    - [ ] FilterProject的Tag过滤接口
- [x] 博客归档界面
- [ ] 完善上传功能
    - [x] 上传图片后端
    - [ ] 上传图片前端
- [ ] 完善主题功能 
    - [ ] 自定义主题功能
- [x] 完善GameDevLab
- [x] 完善AboutMe
- [x] 添加了默认图片相关配置

## 2025/5/24 day15
计划
- [ ] 热门博客推荐
- [ ] 博客展示排序/Tag分类
- [ ] 项目展示排序/Tag分类
    - [ ] DisplayProject的Tag过滤接口
    - [ ] FilterProject的Tag过滤接口
- [x] 完善上传功能
    - [x] 上传图片前端
- [ ] 完善主题功能 
    - [ ] 自定义主题功能
- [x] 管理员可删除评论
- [ ] 用户管理界面
    - [x] 用户添加邮箱字段
    - [ ] 后台界面

开发
完成了上传图片的前端界面，使用了MudBlazor的MudFileUpload组件。

打算写一个用户管理界面，防止恶意用户注册。
- 限制每日注册用户数量
- 限制每个用户的每日评论数量

完善一下评论功能，管理员可以在文章界面里看到删除评论按钮并删除。

## 2025/5/25 day16
计划
- [ ] 热门博客推荐
- [ ] 博客展示排序/Tag分类
- [ ] 项目展示排序/Tag分类
    - [ ] DisplayProject的Tag过滤接口
    - [ ] FilterProject的Tag过滤接口
- [ ] 完善主题功能
    - [ ] 自定义主题功能
- [ ] 用户管理界面
    - [ ] 后台界面
- [ ] 给每个界面加上标题
- [ ] 修改网站图标
- [ ] 网站访问人数绘制图加上实际的效果数据
- [ ] 各种管理操作添加修改功能

待修复
- [x] 组件加载的太慢
- [ ] ProjectManager的管理面板显示的信息不够完全
- [ ] 给邮箱添加一个label


执行
今天实际部署了一下
为了让项目可以在生产环境下运行，我需要将项目的配置文件修改为生产环境的配置。
其实我在开发的时候应该减少硬编码的部分，需要调整的采用配置文件/使用数据库的方式。

接下来就是要填充数据了，填充一些个人信息，博客，项目等数据。

### 组件加载太慢问题
有一些组件，比如
- AppBar变得可以被点击很慢
  - 我猜测是登陆功能检查本地存储和后端之间的交互导致的
- Home界面的侧边栏加载慢
  - 我猜测是图片和个人信息加载慢导致的

右边侧边栏加载慢是因为我给它套了个隐藏的样式，导致它在加载的时候会被隐藏，加载完毕后才显示出来。

因为我启用的预渲染模式，直接打开的速度很快，但是部分组件的效果需要在得到服务器连接后才能生效，所以会有加载慢的感觉。